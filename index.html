<!DOCTYPE html>
<html>

<body>

    <h2>HTML Iframes</h2>
    <p id="text"></p>
    <script>
        function detectSandbox() {
            if (window.self === window.top) {
                return;
            }

            try {
                if (window.frameElement?.hasAttribute('sandbox')) {
                    document.getElementById("text").innerText = 'sandbox 1';
                }
            } catch {
                // ignore
            }

            try {
                document.domain = document.domain;
            } catch (err) {
                try {
                    if (err.toString().toLowerCase().includes('sandbox')) {
                        document.getElementById("text").innerText = 'sandbox 2';
                    }
                } catch {
                    document.getElementById("text").innerText = 'exception 1';
                }
            }

            return false;
        }

        function detectPdfViewer() {
            try {
                if (window.self === window.top) {
                    return;
                }

                if (!window.navigator.plugins.namedItem('Chrome PDF Viewer')) {
                    return;
                }

                const obj = document.createElement('object');
                obj.data = 'data:application/pdf;base64,aG1t';
                obj.style.cssText = 'position:absolute;top:-500px;left:-500px;visibility:hidden;';

                obj.onerror = (event, source, lineno, colno, error) => {
                    debugger
                    function getIOSVersion() {
                        const ua = window.navigator.userAgent;

                        // iOS 13+ dùng "OS 13_0 like Mac OS X"
                        const match = ua.match(/OS (\d+)_?(\d+)?_?(\d+)?/);

                        if (!/iP(hone|od|ad)/.test(ua) || !match) {
                            return null; // Không phải iOS
                        }

                        return {
                            major: parseInt(match[1] || "0"),
                            minor: parseInt(match[2] || "0"),
                            patch: parseInt(match[3] || "0")
                        };
                    }
                    document.getElementById("text").innerText = JSON.stringify(getIOSVersion());
                };

                obj.onload = () => {
                    obj.remove();
                    document.getElementById("text").innerText = 'onload';
                };

                document.body.appendChild(obj);
            } catch {
                //ignore
                document.getElementById("text").innerText = 'exception 2';
            }
        }

        detectSandbox();
        detectPdfViewer();
    </script>
</body>

</html>