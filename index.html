<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
    <meta http-equiv="Permissions-Policy" content="fullscreen=(self 'https://test-streams.mux.dev')">
    <style>
        .video-container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            align-items: center;
        }
        .controls button {
            padding: 8px 12px;
            background: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .controls button:hover {
            background: #ddd;
        }
        .progress-container {
            width: 200px;
            height: 10px;
            background: #555;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
        }
        .progress-bar {
            height: 100%;
            background: #4caf50;
            border-radius: 5px;
            width: 0%;
            transition: width 0.1s linear;
        }
    </style>
</head>
<body>
    <div class="video-container">
        <video id="video" style="width: 100%; height: 100%;" muted autoPlay disableRemotePlayback webkit-playsinline playsInline></video>
        <div class="controls">
            <button id="playPauseBtn">Play</button>
            <button id="unmuteBtn">Unmute</button>
            <button id="seekBackBtn">⏪ 10s</button>
            <button id="seekForwardBtn">10s ⏩</button>
            <button id="fullscreenBtn">Fullscreen</button>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
    </div>
    <script>
        window.onload = function () {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.error('Service Worker registration failed:', err));
            }
            var video = document.getElementById('video');
            var videoSrc = 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8?v=' + new Date().getTime();
            var progressBar = document.getElementById('progressBar');
            var progressContainer = progressBar.parentElement;
            var playPauseBtn = document.getElementById('playPauseBtn');

            // Check for native browser HLS support
            if (video.canPlayType('application/vnd.apple.mpegurl')) {
                alert('here 3');
                video.src = videoSrc;
            } else if (Hls.isSupported()) {
                var hls = new Hls();
                hls.loadSource(videoSrc);
                hls.attachMedia(video);
            }

            // Play/Pause button functionality
            playPauseBtn.addEventListener('click', function() {
                if (video.paused) {
                    video.play().catch(function(error) {
                        console.error('Play error:', error);
                    });
                    this.textContent = 'Pause';
                } else {
                    video.pause();
                    this.textContent = 'Play';
                }
            });

            // Unmute button functionality
            document.getElementById('unmuteBtn').addEventListener('click', function() {
                video.muted = !video.muted;
                this.textContent = video.muted ? 'Unmute' : 'Mute';
            });

            // Seek backward 10 seconds
            document.getElementById('seekBackBtn').addEventListener('click', function() {
                video.currentTime = Math.max(0, video.currentTime - 10);
            });

            // Seek forward 10 seconds
            document.getElementById('seekForwardBtn').addEventListener('click', function() {
                video.currentTime = Math.min(video.duration, video.currentTime + 10);
            });

            // Fullscreen button functionality
            document.getElementById('fullscreenBtn').addEventListener('click', function() {
                if (!document.fullscreenElement) {
                    if (video.requestFullscreen) {
                        video.requestFullscreen().catch(function(error) {
                            console.error('Fullscreen error:', error);
                        });
                    } else if (video.webkitRequestFullscreen) { /* Safari */
                        video.webkitRequestFullscreen();
                    } else if (video.msRequestFullscreen) { /* IE11 */
                        video.msRequestFullscreen();
                    }
                    this.textContent = 'Exit Fullscreen';
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) { /* Safari */
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) { /* IE11 */
                        document.msExitFullscreen();
                    }
                    this.textContent = 'Fullscreen';
                }
            });

            // Update progress bar
            video.addEventListener('timeupdate', function() {
                if (video.duration) {
                    var progressPercent = (video.currentTime / video.duration) * 100;
                    progressBar.style.width = progressPercent + '%';
                }
            });

            // Seek when clicking on progress bar
            progressContainer.addEventListener('click', function(e) {
                var rect = progressContainer.getBoundingClientRect();
                var clickX = e.clientX - rect.left;
                var width = rect.width;
                var seekTime = (clickX / width) * video.duration;
                video.currentTime = seekTime;
            });

            // Update button text when video is played or paused
            video.addEventListener('play', function() {
                playPauseBtn.textContent = 'Pause';
            });
            video.addEventListener('pause', function() {
                playPauseBtn.textContent = 'Play';
            });
        }
    </script>
</body>
</html>
